# Web Application Architecture

![web-app-browser](https://github.com/btdobbs/WA/blob/main/Topic/images/web-app-http.png)

# Browser/Server Communication[^1]

# Hypertext Transport Protocol (HTTP)

## Universal Resource Locator (URL)

`http://www.example.com:80/index.html`

- To display page browser fetches the file index.html from a web server 

  Same as www.example.com (Defaults: port 80, file index.html, http protocol)
  
- HTTP (**H**yper**T**ext **T**ransport **P**rotocol)

- HTTP - Simple request-response **protocol** layered on TCP/IP
  1. Establish a **TCP/IP connection** to `www.example.com:80`
  2. Send a http GET **request** along connection
  3. Read from the connection the **response** from the web server

## Send HTTP Request - Write lines to socket

### Example

**Header**  
```http
GET /index.html HTTP/1.1  
Host: www.example.com  
User-Agent: Mozilla/5.0  
Accept: text/html, */*  
Accept-Language: en-us  
Accept-Charset: ISO-8859-1,utf-8  
Connection: keep-alive  
```
*blank line*

**Body (optional)**
```http

```

*First line of header*:  
Method = GET  
URL = /index.html  
Protocol Version = HTTP/1.1  

## HTTP Methods (Verbs)

- `GET` - Fetch a URL
- `HEAD` - Fetch information about a URL
- `PUT` - Store to an URL
- `POST` - Send form data to a URL and get a response back
- `DELETE` - Delete a URL

`GET` and `POST` (forms) are commonly used. 

REST APIs used `GET`, `PUT`, `POST`, and `DELETE`

## HTTP Response - Read lines from socket

**Header**  
```http
HTTP/1.1 200 OK
Date: Thu, 24 Jul 2008 17:36:27 GMT 
Server: Apache-Coyote/1.1 
Content-Type: text/html;charset=UTF-8 
Content-Length: 1846 
```
*blank line*

**Body (optional)**
```http
<?xml ... >
<!DOCTYPE html ... >
<html ... >
...
</html>
```

*First line of header*:  
Version = HTTP/1.1  
Status = 200  
Status Message = OK

## Common HTTP Response Status Codes

| Status | Status Message        | Notes                                               |
| ------ | --------------------- | --------------------------------------------------- |
| 200    | OK                    | Success                                             |
| 307    | Temporary Redirect    | Redirection - Browser retries using Location header |
| 404    | Not Found             | Famous one                                          |
| 503    | Service Unavailable   | Something crashed on the server                     |
| 500    | Internal Server Error | Something is messed up on the server                | 
| 501    | Not Implemented       | Coming soon                                         |
| 400    | Bad Request           | Use if web app sends bogus request                  |
| 401    | Unauthorized          | Use if user isn't logged in                         |
| 403    | Forbidden             | Use if even logging in wouldn't help                | 
| 550    | Permission denied     | Not allow to perform request                        |


[Funny 404 Messages](https://www.google.com/search?q="funny 404")

## Browser caching control

- HTTP Response Header: `Cache-Control: max-age=<Seconds>`
  
  - Browser can reuse reply younger than the max-age

  - `Cache-Control: max-age=120` - Age out in two minutes. 

- Frequently used on fetches of static content like images, templates, CSS, JavaScript.

  - **Good**: Reduce app startup latency and server load 

  - **Bad**: Changes might not be picked up right away

  - Consider Web App changes?

## Browser spends its life fetching things using HTTP

- Some fetched immediately (processing paused while waiting for HTTP reply)

  ```xhtml
  <link href="angular-material.css" rel="stylesheet" />
  <script src="compiled/p2.bundle.js" type="text/javascript" />
  window.location = "http://www.example.com";
  ```
  
- Some asynchronous and in parallel
 
  ```xhtml
  <img src="smiley.gif">
  <img src="foobar.jpg">
  <img src="foobar2.jpg">
  ```
  
- Some can be in background

  ```xhtml
  <a href="http://www.example.com"></a>
  ```

## What would this JavaScript do?

  ```javascript
  elm.innerHTML ="<script src="http://www.example.com/myJS.js" type="text/javascript" ></script>"
  ```

  Uses HTTP to fetch myJS.js and runs it! Scary but useful.

# Controller/Server Communication


[^1]: [Stanford Computer Science](https://cs.stanford.edu)
