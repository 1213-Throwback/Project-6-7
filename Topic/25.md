# Large Scale Applications[^1]

## Web Application Architecture

![web-app](https://github.com/btdobbs/WA/blob/main/Topic/images/web-app.png)

- Multiple options for each tier
  - Web Browser
    - **Chrome**
    - Mozilla Firefox
    - Safari
    - Internet Explorer/Edge
    - Other
  - Web/App Server
    - **Node**
    - Apache HTTP Server
    - Nginx
    - Rails
    - Internet Information Server
    - Other 
  - Storage System 
    - **MongoDB**
    - MySQL
    - SQL Server
    - Oracle
    - PostgreSQL
    - Other 

## Large-Scale: Scale-Out Architecture

![large-web-app](https://github.com/btdobbs/WA/blob/main/Topic/images/web-app-large-scale.png)

## Scale-out architecture

- Expand capacity by adding more instances
- Contrast: **Scale-up architecture** - Switch to a bigger instance
  - Quickly hit limits on how big of single instances you can build
- Benefits of scale-out
  - Can scale to fit needs: Just add or remove instances
  - Natural redundancy make tolerating failures easier: One instance dies others keep working
- Challenge: Need to manage multiple instances and distribute work to them

## Scale out web servers: Which server do you use?

- Browsers want to speak HTTP to a web server - TCP/IP connect
- Use load balancing to distribute incoming HTTP requests across many front-end web servers
- HTTP redirection (e.g. HotMail):
  - Front-end machine accepts initial connections
  - Redirects them among an array of back-end machines
- DNS (Domain Name System) load balancing:
  - Specify multiple targets for a given name
  - Handles geographically distributed system
  - DNS servers rotate among those targets

## Load-balancing switch ("Layer 4-7 Switch")

- Special load balancer network switch
  - Incoming packets pass through load balancer switch between Internet and web servers
  - Load balancer directs TCP connection request to one of the many web servers
  - Load balancer will send all packets for that connection to the same server.
- In some cases the switches are smart enough to inspect session cookies, so that the same session always goes to the same server.
- Stateless servers make load balancing easier (different requests from the same user can be handled by different servers).
- Can select web server based on random or on load estimates

## nginx ("Engine X")

- Super efficient web server (i.e. speaks HTTP)
  - Handles 10s of thousands of HTTP connections
- Uses:
  - Load balancing - Forward requests to collection of front-end web servers
  - Handles front-end web servers coming and going (dynamic pools of server)
    - Fault tolerant - web server dies the load balance just quits using it
  - Handles some simple request - static files, etc.
  - DOS mitigation - request rate limits
- Popular approach to shielding Node.js web servers

## Scale-out assumption: any web server will do

- Stateless servers make load balancing easier
  - Different requests from the same user can be handled by different servers
  - Requires database to be shared across web servers
- What about session state?
  - Accessed on every request so needs to be fast (memcache?)
- WebSockets bind browsers and web server â—‹ Can not load balance each request

## Scale-out storage system
- Traditionally Web applications have started off using relational databases
- A single database instance doesn't scale very far.
- Data sharding - Spread database over scale-out instances
  - Each piece is called data shard
  - Can tolerate failures by replication - place more than one copy of data (3 is common)
- Applications must partition data among multiple independent databases, which adds complexity.
  - Facebook initial model: One database instance per university
  - In 2009: Facebook had 4000 MySQL servers - Use hash function to select data shard

## Memcache: main-memory caching system

- Key-value store (both keys and values are arbitrary blobs)
- Used to cache results of recent database queries
- Much faster than databases:
  - 500-microsecond access time, vs. 10's of milliseconds
- Example: Facebook had 2000 memcache servers by 2009
  - Writes must still go to the DBMS, so no performance improvement for them
  - Cache misses still hurt performance
  - Must manage consistency in software (e.g., flush relevant memcache data when database gets modified)

## Scale-out web architecture

```mermaid
```



[^1]: [Stanford Computer Science](https://cs.stanford.edu)
